{% extends "base.html" %}
{% block title %}Video Game API{% endblock %}
{% block content %}
<div class="container text-light">

    <div class="text-center my-5">
        
        <h1 class="my-5 text-info">Video Game API</h1>

        <p>
            Access Steam games detailed information using multiple optional filters across two main endpoints.
        </p>

        <p>
            All API endpoints require a valid Bearer token, which can be generated after registering an account and logging in.
            Use this token in your request headers to authenticate and start exploring the data.
        </p>

    </div>

    <hr style="border-color: grey;">

    <div class="row mb-5 mt-5">

        <!-- Authorisation Docs -->
        <div class="col-md-6">
            <h3 class="text-info mb-3">Authentication</h3>
            <p>
                To access any API endpoint, you must include a valid Bearer token in your request headers.
                Tokens can be generated by registering an account and logging in. Once logged in, click the
                "Generate your Bearer Token" button on the right.
            </p>
            <p><strong>Token expiration:</strong> Tokens are valid for 1 hour from generation. After expiration, generate a new token.</p>
            <p><strong>Usage example (cURL):</strong></p>
            <pre><code>curl -H "Authorization: Bearer &lt;YOUR_TOKEN&gt;" \
            https://yourdomain.com/api/games?name=Half-Life</code></pre>
        </div>

        <!-- Token generation -->
        <div class="col-md-6">
            <div class="p-3 border rounded-4">
                {% if current_user.is_authenticated %}

                    <form method="POST" class="mt-2 mb-3 text-center">
                        <button type="submit" class="btn btn-primary"
                            {% if not token_expired %}disabled{% endif %}>
                            Generate your Bearer Token
                        </button>
                    </form>

                    {% if token %}
                        <p><strong>Your token:</strong></p>
                        <textarea class="form-control" rows="3" readonly>{{ token }}</textarea>
                        <p class="mt-2 text-warning">Tokens expire 1 hour after generation.</p>
                    {% endif %}

                {% else %}

                    <p><a href="{{ url_for('auth.login') }}">Log in</a> or <a href="{{ url_for('auth.register') }}">Register</a> to generate an API token.</p>

                {% endif %}
            </div>
        </div>

    </div>

    <hr style="border-color: grey;">

    <div class="mb-4 mt-5">
        <h3 class="mb-5 text-info">API Endpoints</h3>

        <!-- /api/games -->
        <div class="mt-3">
            <h4 class="mb-5 text-warning">/api/games — Game Details</h4>
            <p><strong>Method:</strong> <span class="badge bg-success">GET</span></p>
            <p><strong>Description:</strong> Search for games by name with optional filters for genre, platform, category, release year, price range, and rating.</p>

            <p><strong>Parameters:</strong></p>
            <table class="table table-dark table-striped table-bordered">
                <thead>
                    <tr>
                        <th>Parameter</th>
                        <th>Type</th>
                        <th>Required</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>name</td><td>string</td><td>Yes</td><td>Game name or partial name to search for</td></tr>
                    <tr><td>release_year</td><td>string</td><td>No</td><td>Filter by release year (YYYY)</td></tr>
                    <tr><td>genre</td><td>string</td><td>No</td><td>Filter by genre name</td></tr>
                    <tr><td>platform</td><td>string</td><td>No</td><td>Filter by platform name</td></tr>
                    <tr><td>category</td><td>string</td><td>No</td><td>Filter by category name</td></tr>
                    <tr><td>rating_min</td><td>float</td><td>No</td><td>Minimum rating percentage (0–100)</td></tr>
                    <tr><td>rating_max</td><td>float</td><td>No</td><td>Maximum rating percentage (0–100)</td></tr>
                    <tr><td>price_min</td><td>float</td><td>No</td><td>Minimum price in GBP</td></tr>
                    <tr><td>price_max</td><td>float</td><td>No</td><td>Maximum price in GBP</td></tr>
                </tbody>
            </table>

            <p><strong>Python example:</strong></p>
            <pre><code>import requests

            headers = {"Authorization": "Bearer &lt;YOUR_TOKEN&gt;"}
            params = {
                "name": "Half-Life",       # required
                "genre": "Action",         # optional
                "platform": "windows",          # optional
                # ...other optional filters available per endpoint
            }

            response = requests.get("https://your-api-domain.com/api/games", headers=headers, params=params)
            print(response.json())</code></pre>

            <p><strong>Example JSON response:</strong></p>
            <pre><code>{
                "count": 2,
                "results": [
                    {
                        "appid": 70,
                        "name": "Half-Life",
                        "release_date": "1998-11-19",
                        "developer": "Valve",
                        "publisher": "Sierra Studios",
                        "price": 8.99,
                        "overall_rating": 96.5,
                        "header_image": "https://steamcdn-a.akamaihd.net/steam/apps/70/header.jpg?t=1530045175",
                        "genres": ["Action", "Sci-fi"],
                        "categories": ["Single-player"],
                        "platforms": ["windows"]
                    },
                    {
                        "appid": 220,
                        "name": "Half-Life 2",
                        "release_date": "2004-11-16",
                        "developer": "Valve",
                        "publisher": "Valve",
                        "price": 9.99,
                        "overall_rating": 97.2,
                        "header_image": "https://steamcdn-a.akamaihd.net/steam/apps/220/header.jpg?t=1541802014",
                        "genres": ["Action", "Sci-fi"],
                        "categories": ["Single-player"],
                        "platforms": ["windows"]
                    }
                ]    
            }</code></pre>

            <p><strong>Usage example (cURL):</strong></p>
            <pre><code>curl -H "Authorization: Bearer &lt;YOUR_TOKEN&gt;" \
            "https://your-api-domain.com/api/games?name=Half-Life&genre=Action&platform=windows"</code></pre>

        </div>

        <!-- /api/games/by-tag -->
        <div class="mt-4">
            <h4 class="mt-5 mb-5 text-warning">/api/games/by-tag — Games by SteamSpy Tag</h4>
            <p><strong>Method:</strong> <span class="badge bg-success">GET</span></p>
            <p><strong>Description:</strong> Search games associated with a specific SteamSpy tag.</p>

            <p><strong>Parameters:</strong></p>
            <table class="table table-dark table-striped table-bordered">
                <thead>
                    <tr>
                        <th>Parameter</th>
                        <th>Type</th>
                        <th>Required</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>tag</td><td>string</td><td>Yes</td><td>Exact SteamSpy tag name</td></tr>
                    <tr><td>platform</td><td>string</td><td>No</td><td>Filter by platform name</td></tr>
                    <tr><td>rating_min</td><td>float</td><td>No</td><td>Minimum rating percentage (0–100)</td></tr>
                    <tr><td>rating_max</td><td>float</td><td>No</td><td>Maximum rating percentage (0–100)</td></tr>
                    <tr><td>price_min</td><td>float</td><td>No</td><td>Minimum price in GBP</td></tr>
                    <tr><td>price_max</td><td>float</td><td>No</td><td>Maximum price in GBP</td></tr>
                </tbody>
            </table>

            <p><strong>Python example:</strong></p>
            <pre><code>params = {
                "tag": "Survival",         # required
                "platform": "windows"           # optional
            }

            response = requests.get("https://your-api-domain.com/api/games/by-tag", headers=headers, params=params)
            print(response.json())</code></pre>

            <p><strong>Example JSON response:</strong></p>
            <pre><code>{
                "count": 2,
                "results": [
                    {
                        "appid": 242760,
                        "name": "The Forest",
                        "release_date": "2018-04-30",
                        "price": 14.99,
                        "overall_rating": 86.3,
                        "header_image": "https://steamcdn-a.akamaihd.net/steam/apps/242760/header.jpg?t=1527008565",
                        "platforms": ["windows"]
                    },
                    {
                        "appid": 815370,
                        "name": "Green Hell",
                        "release_date": "2019-09-06",
                        "price": 19.99,
                        "overall_rating": 82.1,
                        "header_image": "https://steamcdn-a.akamaihd.net/steam/apps/815370/header.jpg?t=1554151175",
                        "platforms": ["windows"]
                    }
                ]
            }</code></pre>

            <p><strong>Usage example (cURL):</strong></p>
            <pre><code>curl -H "Authorization: Bearer &lt;YOUR_TOKEN&gt;" \
            "https://your-api-domain.com/api/games/by-tag?tag=Survival&platform=windows"</code></pre>


        </div>

        <!-- /api/tags -->
        <div class="mt-4 mb-5">
            <h4 class="mt-5 mb-4 text-warning">/api/tags — List All Tags</h4>
            <p><strong>Method:</strong> <span class="badge bg-success">GET</span></p>
            <p><strong>Description:</strong> Returns a list of all SteamSpy tags available.</p>

            <p><strong>Python example:</strong></p>
            <pre><code>response = requests.get("https://your-api-domain.com/api/tags", headers=headers)
            print(response.json())</code></pre>

            <p><strong>Example JSON response:</strong></p>
            <pre><code>{
                "count": 10,
                "results": [
                    "Action",
                    "Adventure",
                    "RPG",
                    "Shooter",
                    "Survival",
                    "Strategy",
                    "Simulation",
                    "Sports",
                    "Indie",
                    "Casual",
                    ...
                ]
            }</code></pre>

            <p><strong>Usage example (cURL):</strong></p>
            <pre><code>curl -H "Authorization: Bearer &lt;YOUR_TOKEN&gt;" \
            "https://your-api-domain.com/api/tags"</code></pre>

        </div>

    </div>

</div>
{% endblock %}